# å°é“ v0.9.0 è¿­ä»£è®¡åˆ’

> åŸºäº CCB å¤š AI åä½œåˆ†æ (Claude + Codex + Gemini + DeepSeek)

---

## ç‰ˆæœ¬ç›®æ ‡

**v0.9.0 - Agent SDK & Provider æ‰©å±•**

æ ¸å¿ƒç›®æ ‡ï¼š
1. é™ä½è‡ªå®šä¹‰ Agent å¼€å‘é—¨æ§›
2. æ‰©å±• LLM Provider æ”¯æŒ
3. æå‡ç”¨æˆ·ä½“éªŒ
4. å®Œå–„æµ‹è¯•è¦†ç›–

---

## åŠŸèƒ½è§„åˆ’

### P0 - æ ¸å¿ƒåŠŸèƒ½

#### 1. Agent SDK v2 (å£°æ˜å¼é…ç½®)

**ç›®æ ‡**: è®©è‡ªå®šä¹‰ Agent ä»"å†™ä¸€å¥—å¾ªç¯"å˜ä¸º"ç»„åˆç»„ä»¶"

```python
# ç›®æ ‡ API è®¾è®¡
from xiaotie import AgentBuilder, Tool, Memory

agent = (
    AgentBuilder("my-agent")
    .with_llm("claude-sonnet-4")
    .with_tools([ReadTool(), WriteTool(), BashTool()])
    .with_memory(ConversationMemory(max_tokens=4000))
    .with_hooks(
        on_start=lambda: print("Agent started"),
        on_tool_call=lambda t: print(f"Calling {t.name}"),
    )
    .build()
)
```

**å®ç°è¦ç‚¹**:
- `AgentBuilder` æ„å»ºå™¨æ¨¡å¼
- `AgentSpec` å£°æ˜å¼é…ç½® (YAML/JSON)
- ç”Ÿå‘½å‘¨æœŸ hooks (on_start, on_step, on_tool_call, on_complete)
- ç­–ç•¥/è®°å¿†/å·¥å…·è§£è€¦

**å¤æ‚åº¦**: ä¸­ | **æ”¶ç›Š**: é«˜

#### 2. Provider é€‚é…å±‚ + èƒ½åŠ›çŸ©é˜µ

**ç›®æ ‡**: ç»Ÿä¸€æ¥å£ï¼Œæ”¯æŒæ›´å¤š LLM Provider

| Provider | æµå¼ | å·¥å…·è°ƒç”¨ | å¹¶è¡Œå·¥å…· | è§†è§‰ | çŠ¶æ€ |
|----------|------|----------|----------|------|------|
| Claude | âœ… | âœ… | âœ… | âœ… | å·²æ”¯æŒ |
| OpenAI | âœ… | âœ… | âœ… | âœ… | å·²æ”¯æŒ |
| GLM-4.7 | âœ… | âœ… | âŒ | âŒ | å·²æ”¯æŒ |
| MiniMax | âœ… | âœ… | âŒ | âŒ | å·²æ”¯æŒ |
| Gemini | âœ… | âœ… | âœ… | âœ… | **æ–°å¢** |
| DeepSeek | âœ… | âœ… | âœ… | âŒ | **æ–°å¢** |
| Qwen | âœ… | âœ… | âœ… | âœ… | **æ–°å¢** |

**å®ç°è¦ç‚¹**:
- ç»Ÿä¸€ `LLMProvider` æŠ½è±¡æ¥å£
- èƒ½åŠ›æ¢æµ‹æœºåˆ¶ (`capabilities()`)
- è‡ªåŠ¨è·¯ç”±/é™çº§ç­–ç•¥
- OpenAI å…¼å®¹ç«¯ç‚¹é€‚é…

**å¤æ‚åº¦**: ä¸­é«˜ | **æ”¶ç›Š**: é«˜

### P1 - ç”¨æˆ·ä½“éªŒ

#### 3. å‘½ä»¤é¢æ¿ (Command Palette)

**ç›®æ ‡**: ç±»ä¼¼ VS Code çš„ Ctrl+K å¿«é€Ÿå‘½ä»¤

**åŠŸèƒ½**:
- æ¨¡ç³Šæœç´¢å‘½ä»¤
- å¿«é€Ÿåˆ‡æ¢æ¨¡å‹
- æœç´¢å†å²è®°å½•
- è§¦å‘ Agent æŠ€èƒ½

**Textual å®ç°**:
```python
class CommandPalette(ModalScreen):
    def compose(self):
        yield Input(placeholder="Type a command...")
        yield ListView(id="results")

    def on_input_changed(self, event):
        # æ¨¡ç³Šæœç´¢åŒ¹é…
        results = fuzzy_search(event.value, self.commands)
        self.update_results(results)
```

**å¤æ‚åº¦**: ä¸­ | **æ”¶ç›Š**: é«˜

#### 4. é¦–æ¬¡å¯åŠ¨å‘å¯¼

**ç›®æ ‡**: é›¶é…ç½®å¯åŠ¨ä½“éªŒ

**æµç¨‹**:
1. æ£€æµ‹æ— é…ç½®æ–‡ä»¶
2. TUI å‘å¯¼å¼•å¯¼
3. è¾“å…¥ API Key
4. é€‰æ‹©é»˜è®¤æ¨¡å‹
5. æµ‹è¯•è¿æ¥
6. ç”Ÿæˆé…ç½®æ–‡ä»¶

**å¤æ‚åº¦**: ä½ | **æ”¶ç›Š**: ä¸­

### P2 - æµ‹è¯•ä¸æ–‡æ¡£

#### 5. TUI äº¤äº’æµ‹è¯•

**ç›®æ ‡**: ä½¿ç”¨ Textual Pilot è‡ªåŠ¨åŒ–æµ‹è¯•

```python
async def test_help_command():
    async with XiaoTieApp().run_test() as pilot:
        await pilot.press("slash")  # /
        await pilot.type("help")
        await pilot.press("enter")
        assert "Available commands" in pilot.app.screen.query_one("#output").text
```

#### 6. LLM å“åº”å½•åˆ¶

**ç›®æ ‡**: ä½¿ç”¨ VCR.py å½•åˆ¶ API å“åº”ï¼Œé¿å…çœŸå®è°ƒç”¨

```python
@vcr.use_cassette('fixtures/claude_hello.yaml')
async def test_claude_response():
    client = LLMClient(provider="anthropic")
    response = await client.chat("Hello")
    assert "Hello" in response.content
```

#### 7. æ–‡æ¡£å¢å¼º

- VHS å½•åˆ¶åŠ¨æ€æ¼”ç¤º GIF
- MCP é…ç½®æ¨¡æ¿å’Œç¤ºä¾‹
- "Hello World" Agent æ•™ç¨‹
- API å‚è€ƒæ–‡æ¡£

---

## æ¶æ„æ”¹è¿›

### äº‹ä»¶é©±åŠ¨è§£è€¦

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   TUI/CLI   â”‚ â†â”€â”€ â”‚  Event Bus  â”‚ â†â”€â”€ â”‚    Agent    â”‚
â”‚  (View)     â”‚     â”‚  (Broker)   â”‚     â”‚   (Core)    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â†‘
                    â”Œâ”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”
                    â”‚   Events    â”‚
                    â”‚ - AgentStartâ”‚
                    â”‚ - ToolCall  â”‚
                    â”‚ - Response  â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### è®°å¿†æ£€ç´¢ç®¡é“

```
Query â†’ Rewrite â†’ Semantic Search â†’ Rerank â†’ Context Injection
                      â†“
                  ChromaDB
```

---

## å®æ–½è®¡åˆ’

### Week 1-2: Agent SDK v2
- [x] AgentBuilder å®ç° âœ…
- [x] AgentSpec YAML è§£æ âœ…
- [x] ç”Ÿå‘½å‘¨æœŸ hooks âœ…
- [x] å•å…ƒæµ‹è¯• (18 tests) âœ…

### Week 3-4: Provider æ‰©å±•
- [x] LLMProvider æŠ½è±¡é‡æ„ âœ…
- [x] Gemini é€‚é… âœ…
- [x] DeepSeek é€‚é… âœ…
- [x] Qwen é€‚é… âœ…
- [x] èƒ½åŠ›çŸ©é˜µæµ‹è¯• (29 tests) âœ…

### Week 5: UX å¢å¼º
- [x] Command Palette (26 tests) âœ…
- [x] é¦–æ¬¡å¯åŠ¨å‘å¯¼ (17 tests) âœ…
- [x] æµå¼æ¸²æŸ“ä¼˜åŒ– (23 tests) âœ…

### Week 6: æµ‹è¯•ä¸æ–‡æ¡£
- [x] Textual Pilot æµ‹è¯• (15 tests) âœ…
- [x] LLM å“åº”å½•åˆ¶ (27 tests) âœ… (è‡ªç ” Cassette ç³»ç»Ÿæ›¿ä»£ VCR.py)
- [x] æ–‡æ¡£æ›´æ–° âœ…
- [x] VHS æ¼”ç¤ºå½•åˆ¶ âœ… (3 ä¸ª tape è„šæœ¬)

---

## å®Œæˆæ€»ç»“

**v0.9.0 å¼€å‘å®Œæˆï¼** ğŸ‰

### æµ‹è¯•ç»Ÿè®¡
- æ€»æµ‹è¯•æ•°: 231 passed, 15 skipped
- æ–°å¢æµ‹è¯•: 114 tests
  - Provider é€‚é…å±‚: 29 tests
  - Command Palette: 26 tests
  - Onboarding Wizard: 17 tests
  - TUI Pilot: 15 tests
  - LLM å“åº”å½•åˆ¶: 27 tests
  - æµå¼æ¸²æŸ“: 23 tests (é¢å¤–)

### æ–°å¢æ¨¡å—
- `xiaotie/builder.py` - AgentBuilder SDK v2
- `xiaotie/llm/providers.py` - Provider é€‚é…å±‚
- `xiaotie/tui/command_palette.py` - å‘½ä»¤é¢æ¿
- `xiaotie/tui/onboarding.py` - é¦–æ¬¡å¯åŠ¨å‘å¯¼
- `xiaotie/tui/streaming.py` - æµå¼æ¸²æŸ“ä¼˜åŒ–
- `xiaotie/testing/__init__.py` - æµ‹è¯•æ¨¡å—

---

## å‚è€ƒèµ„æº

- [Gemini Function Calling](https://ai.google.dev/gemini-api/docs/tools)
- [Qwen API](https://www.alibabacloud.com/help/en/model-studio/qwen-api-via-dashscope)
- [MCP Protocol](https://docs.anthropic.com/en/docs/mcp)
- [Textual Pilot](https://textual.textualize.io/guide/testing/)
- [VCR.py](https://vcrpy.readthedocs.io/)

---

## è´¡çŒ®è€…

- **Claude** - ä¸»å¯¼å¼€å‘
- **Codex** - åŠŸèƒ½å»ºè®®ã€ä»£ç å®¡æŸ¥
- **Gemini** - UX è®¾è®¡ã€æ–‡æ¡£å»ºè®®
- **DeepSeek** - æ¶æ„åˆ†æã€æ€§èƒ½ä¼˜åŒ–
