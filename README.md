# âš™ï¸ å°é“ (XiaoTie)

è½»é‡çº§ AI Agent æ¡†æ¶ï¼ŒåŸºäº [Mini-Agent](https://github.com/MiniMax-AI/Mini-Agent) æ¶æ„å¤ç°ï¼Œå‚è€ƒ [OpenCode](https://github.com/opencode-ai/opencode) è®¾è®¡ã€‚

```
 â–„â–ˆâ–ˆâ–ˆâ–„     å°é“ XiaoTie v0.9.0
 â–ˆ âš™ â–ˆ    GLM-4.7 Â· OpenAI
 â–€â–ˆâ–ˆâ–ˆâ–€     ~/workspace
```

## ç‰¹æ€§

### æ ¸å¿ƒåŠŸèƒ½
- ğŸ”„ **Agent æ‰§è¡Œå¾ªç¯** - è‡ªåŠ¨å·¥å…·è°ƒç”¨ä¸ä»»åŠ¡å®Œæˆ
- ğŸŒŠ **æµå¼è¾“å‡º** - å®æ—¶æ˜¾ç¤ºæ€è€ƒè¿‡ç¨‹å’Œå›å¤
- ğŸ’­ **æ·±åº¦æ€è€ƒ** - æ”¯æŒ GLM-4.7 thinking æ¨¡å¼
- ğŸ’¾ **ä¼šè¯ç®¡ç†** - ä¿å­˜/åŠ è½½å¯¹è¯å†å²
- ğŸ“ **Token ç®¡ç†** - è‡ªåŠ¨æ‘˜è¦å†å²æ¶ˆæ¯
- âš¡ **ä¼˜é›…å–æ¶ˆ** - æ”¯æŒ Ctrl+C ä¸­æ–­
- ğŸš€ **å¹¶è¡Œå·¥å…·æ‰§è¡Œ** - å¤šå·¥å…·è°ƒç”¨å¹¶è¡Œæ‰§è¡Œï¼Œæå‡æ•ˆç‡
- ğŸ–¥ï¸ **TUI æ¨¡å¼** - åŸºäº Textual çš„ç°ä»£åŒ–ç»ˆç«¯ç•Œé¢
- ğŸ“¤ **éäº¤äº’æ¨¡å¼** - æ”¯æŒå•æ¬¡æŸ¥è¯¢å’Œ JSON è¾“å‡º
- ğŸ”Œ **MCP åè®®æ”¯æŒ** - è¿æ¥ MCP æœåŠ¡å™¨ï¼Œæ‰©å±•å·¥å…·èƒ½åŠ›
- ğŸ”¬ **LSP é›†æˆ** - è¯­è¨€æœåŠ¡å™¨åè®®ï¼Œå®æ—¶è¯Šæ–­
- ğŸ¤– **å¤š Agent åä½œ** - å­ä»»åŠ¡åˆ†è§£ä¸å¹¶è¡Œæ‰§è¡Œ
- ğŸ’¾ **SQLite æŒä¹…åŒ–** - é«˜æ€§èƒ½ä¼šè¯ä¸æ¶ˆæ¯å­˜å‚¨
- ğŸ” **è¯­ä¹‰æœç´¢** - åŸºäºå‘é‡çš„ä»£ç è¯­ä¹‰æœç´¢

### å·¥å…·ç³»ç»Ÿ
- ğŸ“ **æ–‡ä»¶æ“ä½œ** - è¯»å–ã€å†™å…¥ã€ç¼–è¾‘æ–‡ä»¶
- ğŸ–¥ï¸ **Bash å‘½ä»¤** - æ‰§è¡Œ shell å‘½ä»¤
- ğŸ **Python æ‰§è¡Œ** - è¿è¡Œ Python ä»£ç 
- ğŸ”¢ **è®¡ç®—å™¨** - æ•°å­¦è®¡ç®—
- ğŸŒ¿ **Git æ“ä½œ** - ç‰ˆæœ¬æ§åˆ¶ï¼ˆstatus/diff/log/commitï¼‰
- ğŸ” **Web æœç´¢** - DuckDuckGo æœç´¢
- ğŸŒ **ç½‘é¡µè·å–** - è·å–ç½‘é¡µå†…å®¹
- ğŸ“Š **ä»£ç åˆ†æ** - æå–ç±»ã€å‡½æ•°ã€ä¾èµ–å…³ç³»
- ğŸ” **è¯­ä¹‰æœç´¢** - åŸºäºå‘é‡çš„ä»£ç è¯­ä¹‰æœç´¢

### ä»£ç åº“æ„ŸçŸ¥ (RepoMap)
- ğŸ“‚ **ç›®å½•æ ‘** - å¯è§†åŒ–é¡¹ç›®ç»“æ„
- ğŸ—ºï¸ **ä»£ç æ˜ å°„** - æå–ç±»ã€å‡½æ•°å®šä¹‰
- ğŸ” **æ™ºèƒ½æœç´¢** - æŒ‰å…³é”®è¯æŸ¥æ‰¾ç›¸å…³æ–‡ä»¶

### å¤š LLM æ”¯æŒ
- ğŸ¤– **Anthropic Claude** - Claude 3.5/4 ç³»åˆ—
- ğŸ§  **OpenAI GPT** - GPT-4o ç­‰
- ğŸ”® **æ™ºè°± GLM-4.7** - æ·±åº¦æ€è€ƒ + å·¥å…·æµå¼
- ğŸŒˆ **MiniMax** - abab ç³»åˆ—
- ğŸŒŸ **Google Gemini** - Gemini Pro/Flash (v0.9.0 æ–°å¢)
- ğŸ”· **DeepSeek** - DeepSeek Chat/Coder (v0.9.0 æ–°å¢)
- ğŸŸ£ **Qwen** - é€šä¹‰åƒé—®ç³»åˆ— (v0.9.0 æ–°å¢)

## å®‰è£…

```bash
# å…‹éš†é¡¹ç›®
git clone https://github.com/LeoLin990405/xiaotie.git
cd xiaotie

# åŸºç¡€å®‰è£…
pip install -e .

# å®‰è£… TUI æ”¯æŒ
pip install -e ".[tui]"

# å®‰è£…è¯­ä¹‰æœç´¢æ”¯æŒ
pip install -e ".[search]"

# å®‰è£…æ‰€æœ‰åŠŸèƒ½
pip install -e ".[all]"
```

## é…ç½®

1. å¤åˆ¶é…ç½®æ–‡ä»¶æ¨¡æ¿ï¼š

```bash
cp config/config.yaml.example config/config.yaml
```

2. ç¼–è¾‘ `config/config.yaml`ï¼Œå¡«å…¥ä½ çš„ API Keyï¼š

```yaml
# Anthropic Claude
api_key: YOUR_API_KEY
api_base: https://api.anthropic.com
model: claude-sonnet-4-20250514
provider: anthropic

# æˆ–è€… æ™ºè°± GLM-4.7
api_key: YOUR_API_KEY
api_base: https://open.bigmodel.cn/api/coding/paas/v4
model: GLM-4.7
provider: openai
```

### MCP é…ç½®

å°é“æ”¯æŒ [Model Context Protocol (MCP)](https://modelcontextprotocol.io/)ï¼Œå¯ä»¥è¿æ¥ MCP æœåŠ¡å™¨æ‰©å±•å·¥å…·èƒ½åŠ›ã€‚

åœ¨ `config/config.yaml` ä¸­æ·»åŠ  MCP é…ç½®ï¼š

```yaml
# MCP é…ç½®
mcp:
  enabled: true  # å¯ç”¨ MCP æ”¯æŒ
  servers:
    # æ–‡ä»¶ç³»ç»ŸæœåŠ¡å™¨
    filesystem:
      command: npx
      args: ["-y", "@modelcontextprotocol/server-filesystem", "/tmp"]
      enabled: true

    # GitHub æœåŠ¡å™¨
    github:
      command: npx
      args: ["-y", "@modelcontextprotocol/server-github"]
      env:
        GITHUB_PERSONAL_ACCESS_TOKEN: "your-token"
      enabled: true
```

å¯åŠ¨åï¼ŒMCP æœåŠ¡å™¨æä¾›çš„å·¥å…·ä¼šè‡ªåŠ¨åŠ è½½ï¼Œå·¥å…·åç§°æ ¼å¼ä¸º `mcp_<æœåŠ¡å™¨å>_<å·¥å…·å>`ã€‚

## ä½¿ç”¨

### å‘½ä»¤è¡Œæ¨¡å¼

```bash
# å¯åŠ¨äº¤äº’å¼ CLI
xiaotie

# å¯åŠ¨ TUI æ¨¡å¼ (éœ€è¦å®‰è£… tui ä¾èµ–)
xiaotie --tui

# éäº¤äº’æ¨¡å¼ - ç›´æ¥æ‰§è¡ŒæŸ¥è¯¢
xiaotie -p "å¸®æˆ‘åˆ†æè¿™æ®µä»£ç "

# JSON è¾“å‡ºæ ¼å¼
xiaotie -p "ä½ å¥½" -f json

# å®‰é™æ¨¡å¼ - åªè¾“å‡ºç»“æœ
xiaotie -p "1+1ç­‰äºå¤šå°‘" -q

# ç¦ç”¨æµå¼è¾“å‡º
xiaotie --no-stream

# ç¦ç”¨æ·±åº¦æ€è€ƒ
xiaotie --no-thinking
```

### TUI æ¨¡å¼å¿«æ·é”®

| å¿«æ·é”® | è¯´æ˜ |
|--------|------|
| `Ctrl+K` | æ‰“å¼€å‘½ä»¤é¢æ¿ |
| `Ctrl+B` | åˆ‡æ¢ä¾§è¾¹æ  |
| `Ctrl+N` | æ–°å»ºä¼šè¯ |
| `Ctrl+S` | ä¿å­˜ä¼šè¯ |
| `Ctrl+L` | æ¸…å± |
| `Ctrl+Q` | é€€å‡º |
| `F1` | å¸®åŠ© |

### CLI å‘½ä»¤

| å‘½ä»¤ | åˆ«å | è¯´æ˜ |
|------|------|------|
| `/help` | `/h`, `/?` | æ˜¾ç¤ºå¸®åŠ© |
| `/quit` | `/q`, `/exit` | é€€å‡ºç¨‹åº |
| `/reset` | `/r` | é‡ç½®å¯¹è¯ |
| `/tools` | `/t` | æ˜¾ç¤ºå¯ç”¨å·¥å…· |
| `/save` | `/s` | ä¿å­˜å½“å‰ä¼šè¯ |
| `/load <id>` | `/l` | åŠ è½½ä¼šè¯ |
| `/sessions` | | åˆ—å‡ºæ‰€æœ‰ä¼šè¯ |
| `/new [æ ‡é¢˜]` | | åˆ›å»ºæ–°ä¼šè¯ |
| `/stream` | | åˆ‡æ¢æµå¼è¾“å‡º |
| `/think` | | åˆ‡æ¢æ·±åº¦æ€è€ƒ |
| `/parallel` | | åˆ‡æ¢å·¥å…·å¹¶è¡Œæ‰§è¡Œ |
| `/tokens` | `/tok` | æ˜¾ç¤º Token ä½¿ç”¨ |
| `/config` | `/cfg` | æ˜¾ç¤ºå½“å‰é…ç½® |
| `/status` | | æ˜¾ç¤ºç³»ç»ŸçŠ¶æ€ |
| `/compact` | | å‹ç¼©å¯¹è¯å†å² |
| `/copy` | | å¤åˆ¶æœ€åå›å¤åˆ°å‰ªè´´æ¿ |
| `/undo` | | æ’¤é”€æœ€åä¸€è½®å¯¹è¯ |
| `/retry` | | é‡è¯•æœ€åä¸€æ¬¡è¯·æ±‚ |
| `/tree [æ·±åº¦]` | | æ˜¾ç¤ºç›®å½•ç»“æ„ |
| `/map [tokens]` | | æ˜¾ç¤ºä»£ç åº“æ¦‚è§ˆ |
| `/find <å…³é”®è¯>` | | æœç´¢ç›¸å…³æ–‡ä»¶ |
| `/history` | `/hist` | æ˜¾ç¤ºå¯¹è¯å†å² |
| `/plugins` | | æ˜¾ç¤ºå·²åŠ è½½æ’ä»¶ |
| `/plugin-new <åç§°>` | | åˆ›å»ºæ’ä»¶æ¨¡æ¿ |
| `/plugin-reload <åç§°>` | | é‡æ–°åŠ è½½æ’ä»¶ |
| `/clear` | `/c` | æ¸…å± |

### ä»£ç è°ƒç”¨

```python
import asyncio
from xiaotie import Agent
from xiaotie.llm import LLMClient
from xiaotie.tools import ReadTool, WriteTool, BashTool, GitTool

async def main():
    # åˆ›å»º LLM å®¢æˆ·ç«¯
    llm = LLMClient(
        api_key="your-api-key",
        api_base="https://api.anthropic.com",
        model="claude-sonnet-4-20250514",
        provider="anthropic",
    )

    # åˆ›å»ºå·¥å…·
    tools = [
        ReadTool(workspace_dir="."),
        WriteTool(workspace_dir="."),
        BashTool(),
        GitTool(workspace_dir="."),
    ]

    # åˆ›å»º Agent
    agent = Agent(
        llm_client=llm,
        system_prompt="ä½ æ˜¯å°é“ï¼Œä¸€ä¸ªæ™ºèƒ½åŠ©æ‰‹ã€‚",
        tools=tools,
        stream=True,
        enable_thinking=True,
        parallel_tools=True,  # å¹¶è¡Œæ‰§è¡Œå·¥å…·
    )

    # è¿è¡Œ
    result = await agent.run("å¸®æˆ‘åˆ›å»ºä¸€ä¸ª hello.py æ–‡ä»¶")
    print(result)

asyncio.run(main())
```

### Agent SDK v2 (v0.9.0)

```python
from xiaotie import AgentBuilder
from xiaotie.tools import ReadTool, WriteTool, BashTool

# ä½¿ç”¨æ„å»ºå™¨æ¨¡å¼åˆ›å»º Agent
agent = (
    AgentBuilder("my-agent")
    .with_llm("claude-sonnet-4")
    .with_tools([ReadTool(), WriteTool(), BashTool()])
    .with_memory(max_tokens=4000)
    .with_hooks(
        on_start=lambda: print("Agent started"),
        on_tool_call=lambda t: print(f"Calling {t.name}"),
    )
    .build()
)

# è¿è¡Œ
result = await agent.run("å¸®æˆ‘åˆ†æè¿™æ®µä»£ç ")
```

æˆ–ä½¿ç”¨ YAML é…ç½®ï¼š

```yaml
# agent.yaml
name: code-reviewer
llm:
  provider: anthropic
  model: claude-sonnet-4
tools:
  - read
  - write
  - bash
memory:
  type: conversation
  max_tokens: 4000
hooks:
  on_tool_call: log_tool_call
```

```python
from xiaotie import AgentBuilder

agent = AgentBuilder.from_yaml("agent.yaml").build()
```

### äº‹ä»¶è®¢é˜…

```python
import asyncio
from xiaotie import Agent, EventBroker, EventType, get_event_broker

async def main():
    # è·å–äº‹ä»¶ä»£ç†
    broker = get_event_broker()

    # è®¢é˜…äº‹ä»¶
    queue = await broker.subscribe([
        EventType.AGENT_START,
        EventType.TOOL_START,
        EventType.TOOL_COMPLETE,
        EventType.MESSAGE_DELTA,
    ])

    # åˆ›å»º Agent å¹¶è¿è¡Œ...
    agent = Agent(...)

    # åœ¨å¦ä¸€ä¸ªä»»åŠ¡ä¸­å¤„ç†äº‹ä»¶
    async def handle_events():
        while True:
            event = await queue.get()
            if event.type == EventType.TOOL_START:
                print(f"å·¥å…·å¼€å§‹: {event.data.get('tool_name')}")
            elif event.type == EventType.MESSAGE_DELTA:
                print(event.data.get('content'), end='')

    asyncio.create_task(handle_events())
    await agent.run("ä½ å¥½")
```

## æ’ä»¶ç³»ç»Ÿ

å°é“æ”¯æŒé€šè¿‡æ’ä»¶æ‰©å±•åŠŸèƒ½ã€‚æ’ä»¶æ˜¯æ”¾ç½®åœ¨ `~/.xiaotie/plugins/` ç›®å½•ä¸‹çš„ Python æ–‡ä»¶ã€‚

### åˆ›å»ºæ’ä»¶

```bash
# ä½¿ç”¨å‘½ä»¤åˆ›å»ºæ’ä»¶æ¨¡æ¿
/plugin-new my_tool
```

æˆ–æ‰‹åŠ¨åˆ›å»º `~/.xiaotie/plugins/my_tool.py`:

```python
from xiaotie.tools import Tool, ToolResult

class MyTool(Tool):
    @property
    def name(self) -> str:
        return "my_tool"

    @property
    def description(self) -> str:
        return "æˆ‘çš„è‡ªå®šä¹‰å·¥å…·"

    @property
    def parameters(self) -> dict:
        return {
            "type": "object",
            "properties": {
                "input": {"type": "string", "description": "è¾“å…¥å‚æ•°"}
            },
            "required": ["input"]
        }

    async def execute(self, input: str) -> ToolResult:
        return ToolResult(success=True, content=f"ç»“æœ: {input}")
```

### ç®¡ç†æ’ä»¶

| å‘½ä»¤ | è¯´æ˜ |
|------|------|
| `/plugins` | æŸ¥çœ‹å·²åŠ è½½çš„æ’ä»¶ |
| `/plugin-new <åç§°>` | åˆ›å»ºæ’ä»¶æ¨¡æ¿ |
| `/plugin-reload <åç§°>` | çƒ­é‡è½½æ’ä»¶ |

## è‡ªå®šä¹‰å‘½ä»¤

å°é“æ”¯æŒ OpenCode é£æ ¼çš„è‡ªå®šä¹‰å‘½ä»¤ï¼Œå¯ä»¥åˆ›å»ºé¢„å®šä¹‰çš„æç¤ºæ¨¡æ¿ã€‚

### å‘½ä»¤ä½ç½®

- **ç”¨æˆ·å‘½ä»¤** (å‰ç¼€ `user:`):
  - `~/.config/xiaotie/commands/`
  - `~/.xiaotie/commands/`
- **é¡¹ç›®å‘½ä»¤** (å‰ç¼€ `project:`):
  - `<é¡¹ç›®ç›®å½•>/.xiaotie/commands/`

### åˆ›å»ºå‘½ä»¤

```bash
# åˆ›å»ºç”¨æˆ·å‘½ä»¤
/cmd-new review-code

# åˆ›å»ºé¡¹ç›®å‘½ä»¤
/cmd-new-project deploy
```

æˆ–æ‰‹åŠ¨åˆ›å»º Markdown æ–‡ä»¶ï¼Œå¦‚ `~/.xiaotie/commands/review-code.md`:

```markdown
# ä»£ç å®¡æŸ¥

è¯·å®¡æŸ¥ä»¥ä¸‹æ–‡ä»¶çš„ä»£ç è´¨é‡ï¼š

æ–‡ä»¶: $FILE_PATH

é‡ç‚¹å…³æ³¨ï¼š
1. ä»£ç é£æ ¼
2. æ½œåœ¨ bug
3. æ€§èƒ½é—®é¢˜
4. å®‰å…¨æ¼æ´

RUN git diff $FILE_PATH
```

### å‘½åå‚æ•°

ä½¿ç”¨ `$NAME` æ ¼å¼å®šä¹‰å‚æ•°ï¼ˆå¤§å†™å­—æ¯ã€æ•°å­—ã€ä¸‹åˆ’çº¿ï¼Œå¿…é¡»ä»¥å­—æ¯å¼€å¤´ï¼‰ï¼š

```markdown
# åˆ†æ Issue

RUN gh issue view $ISSUE_NUMBER --json title,body,comments
RUN git grep "$SEARCH_PATTERN" .
```

æ‰§è¡Œå‘½ä»¤æ—¶ï¼Œç³»ç»Ÿä¼šæç¤ºè¾“å…¥å‚æ•°å€¼ã€‚

### å­ç›®å½•ç»„ç»‡

å¯ä»¥ä½¿ç”¨å­ç›®å½•ç»„ç»‡å‘½ä»¤ï¼š

```
~/.xiaotie/commands/
â”œâ”€â”€ git/
â”‚   â”œâ”€â”€ commit.md      -> user:git:commit
â”‚   â””â”€â”€ review.md      -> user:git:review
â””â”€â”€ deploy/
    â””â”€â”€ staging.md     -> user:deploy:staging
```

### å‘½ä»¤ç®¡ç†

| å‘½ä»¤ | è¯´æ˜ |
|------|------|
| `/commands` | åˆ—å‡ºæ‰€æœ‰è‡ªå®šä¹‰å‘½ä»¤ |
| `/run <å‘½ä»¤ID>` | æ‰§è¡Œè‡ªå®šä¹‰å‘½ä»¤ |
| `/cmd-new <åç§°>` | åˆ›å»ºç”¨æˆ·å‘½ä»¤ |
| `/cmd-new-project <åç§°>` | åˆ›å»ºé¡¹ç›®å‘½ä»¤ |
| `/cmd-reload` | é‡æ–°åŠ è½½å‘½ä»¤ |
| `/cmd-show <å‘½ä»¤ID>` | æ˜¾ç¤ºå‘½ä»¤å†…å®¹ |

## é¡¹ç›®ç»“æ„

```
xiaotie/
â”œâ”€â”€ xiaotie/
â”‚   â”œâ”€â”€ __init__.py       # åŒ…å…¥å£
â”‚   â”œâ”€â”€ agent.py          # Agent æ ¸å¿ƒå¾ªç¯
â”‚   â”œâ”€â”€ cli.py            # CLI å…¥å£
â”‚   â”œâ”€â”€ config.py         # é…ç½®ç®¡ç†
â”‚   â”œâ”€â”€ schema.py         # æ•°æ®æ¨¡å‹
â”‚   â”œâ”€â”€ retry.py          # é‡è¯•æœºåˆ¶
â”‚   â”œâ”€â”€ banner.py         # å¯åŠ¨åŠ¨ç”»
â”‚   â”œâ”€â”€ session.py        # ä¼šè¯ç®¡ç†
â”‚   â”œâ”€â”€ commands.py       # å‘½ä»¤ç³»ç»Ÿ
â”‚   â”œâ”€â”€ custom_commands.py # è‡ªå®šä¹‰å‘½ä»¤
â”‚   â”œâ”€â”€ display.py        # æ˜¾ç¤ºå¢å¼º
â”‚   â”œâ”€â”€ repomap.py        # ä»£ç åº“æ˜ å°„
â”‚   â”œâ”€â”€ plugins.py        # æ’ä»¶ç³»ç»Ÿ
â”‚   â”œâ”€â”€ mcp/              # MCP åè®®æ”¯æŒ
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ protocol.py   # åè®®ç±»å‹å®šä¹‰
â”‚   â”‚   â”œâ”€â”€ transport.py  # Stdio ä¼ è¾“
â”‚   â”‚   â”œâ”€â”€ client.py     # MCP å®¢æˆ·ç«¯
â”‚   â”‚   â””â”€â”€ tools.py      # å·¥å…·åŒ…è£…å™¨
â”‚   â”œâ”€â”€ lsp/              # LSP åè®®æ”¯æŒ
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ protocol.py   # LSP åè®®ç±»å‹
â”‚   â”‚   â”œâ”€â”€ client.py     # LSP å®¢æˆ·ç«¯
â”‚   â”‚   â”œâ”€â”€ manager.py    # æœåŠ¡å™¨ç®¡ç†
â”‚   â”‚   â””â”€â”€ diagnostics.py # è¯Šæ–­å·¥å…·
â”‚   â”œâ”€â”€ storage/          # SQLite å­˜å‚¨
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ database.py   # æ•°æ®åº“è¿æ¥
â”‚   â”‚   â”œâ”€â”€ models.py     # æ•°æ®æ¨¡å‹
â”‚   â”‚   â”œâ”€â”€ session_store.py # ä¼šè¯å­˜å‚¨
â”‚   â”‚   â””â”€â”€ message_store.py # æ¶ˆæ¯å­˜å‚¨
â”‚   â”œâ”€â”€ search/           # è¯­ä¹‰æœç´¢
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ embeddings.py # åµŒå…¥ç”Ÿæˆ
â”‚   â”‚   â”œâ”€â”€ vector_store.py # å‘é‡å­˜å‚¨
â”‚   â”‚   â””â”€â”€ semantic_search.py # è¯­ä¹‰æœç´¢
â”‚   â”œâ”€â”€ multi_agent/      # å¤š Agent åä½œ
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ roles.py      # è§’è‰²å®šä¹‰
â”‚   â”‚   â”œâ”€â”€ task_agent.py # ä»»åŠ¡ Agent
â”‚   â”‚   â”œâ”€â”€ coordinator.py # åè°ƒå™¨
â”‚   â”‚   â””â”€â”€ agent_tool.py # Agent å·¥å…·
â”‚   â”œâ”€â”€ tui/              # TUI æ¨¡å—
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ app.py        # TUI ä¸»åº”ç”¨
â”‚   â”‚   â”œâ”€â”€ widgets.py    # è‡ªå®šä¹‰ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ themes.py     # ä¸»é¢˜ç³»ç»Ÿ
â”‚   â”‚   â”œâ”€â”€ command_palette.py # å‘½ä»¤é¢æ¿ (v0.9.0)
â”‚   â”‚   â”œâ”€â”€ onboarding.py # é¦–æ¬¡å¯åŠ¨å‘å¯¼ (v0.9.0)
â”‚   â”‚   â”œâ”€â”€ streaming.py  # æµå¼æ¸²æŸ“ (v0.9.0)
â”‚   â”‚   â””â”€â”€ main.py       # TUI å…¥å£
â”‚   â”œâ”€â”€ testing/          # æµ‹è¯•æ¨¡å— (v0.9.0)
â”‚   â”‚   â””â”€â”€ __init__.py   # Cassette/MockLLMClient
â”‚   â”œâ”€â”€ llm/
â”‚   â”‚   â”œâ”€â”€ base.py       # LLM å®¢æˆ·ç«¯åŸºç±»
â”‚   â”‚   â”œâ”€â”€ wrapper.py    # ç»Ÿä¸€åŒ…è£…å™¨
â”‚   â”‚   â”œâ”€â”€ providers.py  # Provider é€‚é…å±‚ (v0.9.0)
â”‚   â”‚   â”œâ”€â”€ anthropic_client.py
â”‚   â”‚   â””â”€â”€ openai_client.py
â”‚   â”œâ”€â”€ builder.py        # AgentBuilder (v0.9.0)
â”‚   â””â”€â”€ tools/
â”‚       â”œâ”€â”€ base.py       # å·¥å…·åŸºç±»
â”‚       â”œâ”€â”€ file_tools.py # æ–‡ä»¶å·¥å…·
â”‚       â”œâ”€â”€ bash_tool.py  # Bash å·¥å…·
â”‚       â”œâ”€â”€ python_tool.py # Python/è®¡ç®—å™¨
â”‚       â”œâ”€â”€ git_tool.py   # Git å·¥å…·
â”‚       â”œâ”€â”€ web_tool.py   # Web å·¥å…·
â”‚       â””â”€â”€ semantic_search_tool.py # è¯­ä¹‰æœç´¢å·¥å…·
â”œâ”€â”€ tests/                # æµ‹è¯•ç›®å½•
â”‚   â”œâ”€â”€ conftest.py       # æµ‹è¯•é…ç½®
â”‚   â”œâ”€â”€ unit/             # å•å…ƒæµ‹è¯•
â”‚   â””â”€â”€ integration/      # é›†æˆæµ‹è¯•
â”œâ”€â”€ config/
â”‚   â”œâ”€â”€ config.yaml.example
â”‚   â””â”€â”€ system_prompt.md
â”œâ”€â”€ docs/
â”‚   â”œâ”€â”€ v0.3.0-plan.md    # è¿­ä»£è®¡åˆ’
â”‚   â””â”€â”€ v0.9.0-plan.md    # v0.9.0 è®¡åˆ’
â”œâ”€â”€ pyproject.toml
â””â”€â”€ README.md
```

## æ”¯æŒçš„ LLM Provider

| Provider | API Base | è¯´æ˜ |
|----------|----------|------|
| Anthropic | https://api.anthropic.com | Claude å®˜æ–¹ API |
| OpenAI | https://api.openai.com/v1 | GPT ç³»åˆ— |
| æ™ºè°± GLM | https://open.bigmodel.cn/api/coding/paas/v4 | GLM-4.7 æ·±åº¦æ€è€ƒ |
| MiniMax | https://api.minimax.io | è‡ªåŠ¨å¤„ç† URL åç¼€ |
| Gemini | https://generativelanguage.googleapis.com | Google AI (v0.9.0) |
| DeepSeek | https://api.deepseek.com | DeepSeek (v0.9.0) |
| Qwen | https://dashscope.aliyuncs.com | é€šä¹‰åƒé—® (v0.9.0) |
| å…¶ä»– | è‡ªå®šä¹‰ | OpenAI å…¼å®¹ API |

## ç‰ˆæœ¬å†å²

### v0.9.0
- ğŸ—ï¸ **Agent SDK v2** - å£°æ˜å¼ Agent æ„å»º
  - `AgentBuilder` æ„å»ºå™¨æ¨¡å¼ï¼Œé“¾å¼ API
  - `AgentSpec` YAML/JSON é…ç½®æ”¯æŒ
  - ç”Ÿå‘½å‘¨æœŸ hooks (on_start, on_step, on_tool_call, on_complete)
  - ç­–ç•¥/è®°å¿†/å·¥å…·è§£è€¦è®¾è®¡
- ğŸ”Œ **Provider é€‚é…å±‚** - ç»Ÿä¸€ LLM æ¥å£
  - æ–°å¢ Geminiã€DeepSeekã€Qwen æ”¯æŒ
  - èƒ½åŠ›çŸ©é˜µ (æµå¼ã€å·¥å…·è°ƒç”¨ã€å¹¶è¡Œå·¥å…·ã€è§†è§‰)
  - è‡ªåŠ¨è·¯ç”±/é™çº§ç­–ç•¥
- ğŸ¯ **å‘½ä»¤é¢æ¿å¢å¼º** - æ¨¡ç³Šæœç´¢ç®—æ³•
  - ç²¾ç¡®åŒ¹é…ã€å‰ç¼€åŒ¹é…ã€åŒ…å«åŒ¹é…ã€å­åºåˆ—åŒ¹é…
  - å¿«é€Ÿæ¨¡å‹åˆ‡æ¢å™¨
  - å‘½ä»¤åˆ†ç±»ä¸å›¾æ ‡
- ğŸš€ **é¦–æ¬¡å¯åŠ¨å‘å¯¼** - é›¶é…ç½®ä½“éªŒ
  - 5 æ­¥å¼•å¯¼æµç¨‹
  - API Key é…ç½®
  - è¿æ¥æµ‹è¯•
- ğŸŒŠ **æµå¼æ¸²æŸ“ä¼˜åŒ–** - å®æ—¶å“åº”æ˜¾ç¤º
  - 50ms é˜²æŠ–åŠ¨æ›´æ–°
  - Token/ç§’é€Ÿåº¦ç»Ÿè®¡
  - å¹³æ»‘å…‰æ ‡åŠ¨ç”»
- ğŸ§ª **æµ‹è¯•æ¨¡å—** - LLM å“åº”å½•åˆ¶
  - Cassette å½•åˆ¶/å›æ”¾ç³»ç»Ÿ
  - MockLLMClient æµ‹è¯•å®¢æˆ·ç«¯
  - Textual Pilot TUI æµ‹è¯•

### v0.8.2
- ğŸ¨ **ä¸»é¢˜ç®¡ç†å™¨** - å…¨å±€ä¸»é¢˜çŠ¶æ€ç®¡ç†
  - `ThemeManager` å•ä¾‹æ¨¡å¼ç®¡ç†ä¸»é¢˜çŠ¶æ€
  - ä¸»é¢˜å˜æ›´äº‹ä»¶è®¢é˜…/å‘å¸ƒæœºåˆ¶
  - å®æ—¶ CSS å˜é‡æ›´æ–°
- ğŸ”§ **TUI ç»„ä»¶å¢å¼º**
  - `ThemeSelectorItem` - å¸¦é¢œè‰²é¢„è§ˆçš„ä¸»é¢˜é€‰æ‹©é¡¹
  - ä¸»é¢˜é€‰æ‹©å™¨æ˜¾ç¤ºé…è‰²æ–¹æ¡ˆé¢„è§ˆ
  - æ”¹è¿›çš„ä¸»é¢˜åˆ‡æ¢å“åº”

### v0.8.1
- ğŸ¨ **TUI ä¼˜åŒ–** - å‚è€ƒ OpenCode åƒç´ çº§å¤åˆ»
  - 10 ä¸ªä¸»é¢˜é…è‰² (Nord, Dracula, Catppuccin, Tokyo Night ç­‰)
  - æ¨¡å‹é€‰æ‹©å™¨ (Ctrl+M)
  - ä¸»é¢˜é€‰æ‹©å™¨ (Ctrl+T)
  - Toast é€šçŸ¥ç³»ç»Ÿ
  - Nerd Font å›¾æ ‡æ”¯æŒ
  - æ”¹è¿›çš„çŠ¶æ€è¡Œæ˜¾ç¤º
  - æ€è€ƒæŒ‡ç¤ºå™¨åŠ¨ç”»
- ğŸ”§ **TUI ç»„ä»¶å¢å¼º**
  - `Toast` - é€šçŸ¥æç¤º (success/error/warning/info)
  - `ModelSelector` - æ¨¡å‹é€‰æ‹©å™¨
  - `ThemeSelector` - ä¸»é¢˜é€‰æ‹©å™¨
  - `SelectorItem` - é€šç”¨é€‰æ‹©é¡¹
- ğŸ“¦ **ä¸»é¢˜ç³»ç»Ÿ** - `xiaotie/tui/themes.py`
  - å®Œæ•´çš„é¢œè‰²å˜é‡å®šä¹‰
  - Diff é¢œè‰²ã€Markdown é¢œè‰²ã€è¯­æ³•é«˜äº®é¢œè‰²
  - CSS å˜é‡å¯¼å‡ºæ”¯æŒ

### v0.8.0
- ğŸ” **è¯­ä¹‰æœç´¢** - åŸºäºå‘é‡çš„ä»£ç è¯­ä¹‰æœç´¢
  - ä½¿ç”¨ ChromaDB å‘é‡æ•°æ®åº“
  - æ”¯æŒ OpenAI Embeddings
  - è‡ªåŠ¨ä»£ç åˆ†å— (æŒ‰å‡½æ•°/ç±»)
  - ä½™å¼¦ç›¸ä¼¼åº¦æœç´¢
  - æ”¯æŒ 20+ ä»£ç æ–‡ä»¶æ‰©å±•å
- ğŸ”§ **SemanticSearchTool** - è¯­ä¹‰æœç´¢å·¥å…·
  - é›†æˆåˆ° Agent å·¥å…·ç³»ç»Ÿ
  - æ”¯æŒæŸ¥è¯¢ã€ç»“æœæ•°é‡ã€æ–‡ä»¶è¿‡æ»¤
  - è‡ªåŠ¨ç´¢å¼•å·¥ä½œåŒºä»£ç 
- ğŸ“¦ **æ–°æ¨¡å—** - `xiaotie/search/`
  - `embeddings.py` - åµŒå…¥ç”Ÿæˆå™¨
  - `vector_store.py` - å‘é‡å­˜å‚¨
  - `semantic_search.py` - è¯­ä¹‰æœç´¢å¼•æ“

### v0.7.0
- ğŸ’¾ **SQLite æŒä¹…åŒ–** - é«˜æ€§èƒ½å­˜å‚¨ç³»ç»Ÿ
  - ä½¿ç”¨ aiosqlite å¼‚æ­¥æ“ä½œ
  - ä¼šè¯ã€æ¶ˆæ¯ã€æ–‡ä»¶ä¸‰è¡¨è®¾è®¡
  - è‡ªåŠ¨æ•°æ®åº“è¿ç§»
  - WAL æ¨¡å¼æé«˜å¹¶å‘æ€§èƒ½
  - çº§è”åˆ é™¤ä¿è¯æ•°æ®ä¸€è‡´æ€§
- ğŸ“¦ **æ–°æ¨¡å—** - `xiaotie/storage/`
  - `database.py` - æ•°æ®åº“è¿æ¥ç®¡ç†
  - `models.py` - æ•°æ®æ¨¡å‹å®šä¹‰
  - `session_store.py` - ä¼šè¯å­˜å‚¨
  - `message_store.py` - æ¶ˆæ¯å­˜å‚¨

### v0.6.1
- ğŸ¤– **å¤š Agent åä½œ** - å®ç° Agent é—´åä½œ
  - Agent è§’è‰²ç³»ç»Ÿ (MAIN, TASK, ANALYZER, TESTER, DOCUMENTER)
  - è½»é‡çº§ TaskAgent ç”¨äºæ¢ç´¢ä»»åŠ¡
  - AgentCoordinator åè°ƒå™¨ç®¡ç†å¤š Agent
  - AgentTool å·¥å…·ç”¨äºç”Ÿæˆå­ Agent
- ğŸ“¦ **æ–°æ¨¡å—** - `xiaotie/multi_agent/`
  - `roles.py` - è§’è‰²å®šä¹‰ä¸é…ç½®
  - `task_agent.py` - ä»»åŠ¡ Agent å®ç°
  - `coordinator.py` - Agent åè°ƒå™¨
  - `agent_tool.py` - Agent å·¥å…·

### v0.6.0
- ğŸ§ª **æµ‹è¯•åŸºç¡€è®¾æ–½** - å®Œæ•´çš„æµ‹è¯•ä½“ç³»
  - pytest é…ç½®ä¸ fixtures
  - å•å…ƒæµ‹è¯•è¦†ç›–æ ¸å¿ƒæ¨¡å—
  - é›†æˆæµ‹è¯•éªŒè¯ç«¯åˆ°ç«¯æµç¨‹
  - GitHub Actions CI è‡ªåŠ¨åŒ–æµ‹è¯•
- ğŸ“¦ **æ–°ç›®å½•** - `tests/`
  - `tests/unit/` - å•å…ƒæµ‹è¯•
  - `tests/integration/` - é›†æˆæµ‹è¯•
  - `tests/conftest.py` - æµ‹è¯•é…ç½®

### v0.5.2
- ğŸ”¬ **LSP é›†æˆ** - è¯­è¨€æœåŠ¡å™¨åè®®æ”¯æŒ
  - LSP å®¢æˆ·ç«¯å®ç° (stdio é€šä¿¡)
  - å®æ—¶è¯Šæ–­ä¿¡æ¯è·å–
  - å¤šè¯­è¨€æœåŠ¡å™¨ç®¡ç†
  - diagnostics å·¥å…·é›†æˆ
- ğŸ“¦ **æ–°æ¨¡å—** - `xiaotie/lsp/`
  - `protocol.py` - LSP åè®®ç±»å‹
  - `client.py` - LSP å®¢æˆ·ç«¯
  - `manager.py` - æœåŠ¡å™¨ç®¡ç†
  - `diagnostics.py` - è¯Šæ–­å·¥å…·

### v0.5.1
- ğŸ“œ **è‡ªå®šä¹‰å‘½ä»¤ç³»ç»Ÿ** - å‚è€ƒ OpenCode è®¾è®¡
  - ç”¨æˆ·å‘½ä»¤: `~/.xiaotie/commands/`
  - é¡¹ç›®å‘½ä»¤: `.xiaotie/commands/`
  - æ”¯æŒ Markdown æ–‡ä»¶å®šä¹‰å‘½ä»¤
  - æ”¯æŒå‘½åå‚æ•° `$ARG_NAME`
  - æ”¯æŒå­ç›®å½•ç»„ç»‡å‘½ä»¤
- ğŸ”§ **æ–°å‘½ä»¤** - /commands, /run, /cmd-new, /cmd-new-project, /cmd-reload, /cmd-show

### v0.5.0
- ğŸ”Œ **MCP åè®®æ”¯æŒ** - å®ç° Model Context Protocol å®¢æˆ·ç«¯
  - Stdio ä¼ è¾“åè®®æ”¯æŒ
  - è‡ªåŠ¨å·¥å…·å‘ç°ä¸è°ƒç”¨
  - å¤š MCP æœåŠ¡å™¨ç®¡ç†
  - é…ç½®æ–‡ä»¶é›†æˆ
- ğŸ“¦ **æ–°æ¨¡å—** - `xiaotie/mcp/` æ¨¡å—
  - `protocol.py` - MCP åè®®ç±»å‹å®šä¹‰
  - `transport.py` - Stdio ä¼ è¾“å®ç°
  - `client.py` - MCP å®¢æˆ·ç«¯
  - `tools.py` - MCP å·¥å…·åŒ…è£…å™¨

### v0.4.3
- ğŸ”’ **æƒé™ç³»ç»Ÿ** - Human-in-the-Loop å®‰å…¨æœºåˆ¶ï¼Œå‘½ä»¤é£é™©åˆ†ç±»
- ğŸ”„ **Lint/Test åé¦ˆå¾ªç¯** - è‡ªåŠ¨é”™è¯¯æ£€æµ‹ï¼Œå‚è€ƒ Aider è®¾è®¡
- ğŸ“‹ **Profile é…ç½®ç³»ç»Ÿ** - å¤šé…ç½®æ–‡ä»¶æ”¯æŒï¼Œå‚è€ƒ Open Interpreter
- ğŸ–¥ï¸ **å¢å¼º Bash å·¥å…·** - æŒä¹…åŒ– Shell ä¼šè¯ï¼Œå‘½ä»¤æ³¨å…¥æ£€æµ‹
- ğŸ”§ **æ–°å‘½ä»¤** - /lint, /test, /profiles, /profile
- ğŸ› **Bug ä¿®å¤** - ä¿®å¤ asyncio äº‹ä»¶å¾ªç¯å†²çªé—®é¢˜

### v0.4.2
- ğŸ¨ **TUI é‡æ„** - å®Œå…¨å‚è€ƒ OpenCode è®¾è®¡é‡æ„ TUI
- ğŸ“ **åˆ†å‰²å¸ƒå±€** - æ¶ˆæ¯åŒº + ä¼šè¯ä¾§è¾¹æ åˆ†å‰²å¸ƒå±€
- âŒ¨ï¸ **Ctrl+K å‘½ä»¤é¢æ¿** - æ”¯æŒæœç´¢è¿‡æ»¤çš„å‘½ä»¤é¢æ¿
- ğŸ“± **ä¾§è¾¹æ åˆ‡æ¢** - Ctrl+B åˆ‡æ¢ä¼šè¯ä¾§è¾¹æ æ˜¾ç¤º
- ğŸ¯ **çŠ¶æ€è¡Œä¼˜åŒ–** - æ˜¾ç¤ºæ¨¡å‹ã€Tokenã€ä¼šè¯ã€çŠ¶æ€ã€æ¨¡å¼
- ğŸ’­ **æ€è€ƒæŒ‡ç¤ºå™¨** - åŠ¨ç”»æ˜¾ç¤º AI æ€è€ƒçŠ¶æ€
- ğŸ“¡ **äº‹ä»¶é©±åŠ¨æ¶æ„** - Pub/Sub äº‹ä»¶ç³»ç»Ÿï¼Œå®æ—¶ UI æ›´æ–°
- ğŸ”’ **ä¼šè¯çŠ¶æ€ç®¡ç†** - é˜²æ­¢å¹¶å‘è¯·æ±‚å†²çª
- ğŸ“Š **æ™ºèƒ½æ‘˜è¦ä¼˜åŒ–** - é˜ˆå€¼è§¦å‘ã€ä¿ç•™å…³é”®æ¶ˆæ¯
- âš¡ **å·¥å…·æ‰§è¡Œä¼˜åŒ–** - æ”¯æŒé¡ºåº/å¹¶è¡Œæ¨¡å¼åˆ‡æ¢

### v0.4.1
- âŒ¨ï¸ **å¢å¼ºè¾“å…¥** - å‘½ä»¤è‡ªåŠ¨è¡¥å…¨ã€å†å²è®°å½•ã€Ctrl+R æœç´¢
- ğŸ¯ **æ–°å‘½ä»¤** - /config, /status, /compact, /copy, /undo, /retry
- ğŸ“Š **ä¼˜åŒ–æ˜¾ç¤º** - å·¥å…·æ‰§è¡Œç»“æœé¢„è§ˆã€è€—æ—¶ç»Ÿè®¡
- ğŸ”§ **æ›´å¤šåˆ«å** - /c, /r, /s, /l, /t, /tok, /hist, /cfg
- ğŸ› **Bug ä¿®å¤** - GLM-4.7 å‚æ•°ä¼ é€’ã€é‡å¤è¾“å‡ºé—®é¢˜

### v0.4.0
- ğŸ–¥ï¸ **TUI æ¨¡å¼** - åŸºäº Textual çš„ç°ä»£åŒ–ç»ˆç«¯ç•Œé¢
- ğŸ“¤ **éäº¤äº’æ¨¡å¼** - æ”¯æŒ `-p` å‚æ•°ç›´æ¥æ‰§è¡ŒæŸ¥è¯¢
- ğŸ¨ **JSON è¾“å‡º** - æ”¯æŒ `-f json` æ ¼å¼åŒ–è¾“å‡º
- âŒ¨ï¸ **å‘½ä»¤é¢æ¿** - Ctrl+P å¿«é€Ÿè®¿é—®å‘½ä»¤
- ğŸ¯ **å‘½ä»¤è¡Œå‚æ•°** - æ”¯æŒ --tui, --no-stream, --no-thinking ç­‰
- å‚è€ƒ [OpenCode](https://github.com/opencode-ai/opencode) è®¾è®¡

### v0.3.1
- ğŸš€ **å·¥å…·å¹¶è¡Œæ‰§è¡Œ** - å¤šå·¥å…·è°ƒç”¨ä½¿ç”¨ asyncio.gather å¹¶è¡Œæ‰§è¡Œ
- ğŸ”Œ **æ’ä»¶ç³»ç»Ÿ** - æ”¯æŒè‡ªå®šä¹‰å·¥å…·çƒ­åŠ è½½
- æ–°å‘½ä»¤ï¼š/parallel, /plugins, /plugin-new, /plugin-reload
- æ‰§è¡Œæ—¶é—´ç»Ÿè®¡

### v0.3.0
- å‘½ä»¤ç³»ç»Ÿé‡æ„ï¼ˆçº¦å®šä¼˜äºé…ç½®ï¼‰
- æ˜¾ç¤ºå¢å¼ºï¼ˆrich åº“æ”¯æŒï¼‰
- ä»£ç åº“æ„ŸçŸ¥ï¼ˆRepoMapï¼‰
- Git å·¥å…·
- Web æœç´¢/è·å–å·¥å…·
- æ–°å‘½ä»¤ï¼š/tree, /map, /find, /tokens, /history

### v0.2.0
- æµå¼è¾“å‡º + æ·±åº¦æ€è€ƒ
- ä¼šè¯ç®¡ç†
- Python/è®¡ç®—å™¨å·¥å…·
- GLM-4.7/MiniMax é€‚é…

### v0.1.0
- åˆå§‹ç‰ˆæœ¬
- Agent æ‰§è¡Œå¾ªç¯
- æ–‡ä»¶/Bash å·¥å…·
- å¤š LLM Provider æ”¯æŒ

## è‡´è°¢

æœ¬é¡¹ç›®åŸºäº [MiniMax-AI/Mini-Agent](https://github.com/MiniMax-AI/Mini-Agent) æ¶æ„å¤ç°ï¼Œæ„Ÿè°¢åŸä½œè€…çš„å¼€æºè´¡çŒ®ï¼

åŒæ—¶å­¦ä¹ å€Ÿé‰´äº†ä»¥ä¸‹ä¼˜ç§€é¡¹ç›®çš„è®¾è®¡æ¨¡å¼ï¼š
- [Aider](https://github.com/Aider-AI/aider) - å‘½ä»¤ç³»ç»Ÿã€RepoMap
- [Open Interpreter](https://github.com/openinterpreter/open-interpreter) - æµå¼å¤„ç†ã€æ˜¾ç¤º
- [Devika](https://github.com/stitionai/devika) - å¤š Agent æ¶æ„
- [MCP Python SDK](https://github.com/modelcontextprotocol/python-sdk) - MCP åè®®å®ç°å‚è€ƒ

## License

MIT
